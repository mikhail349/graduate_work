# Разработать сервис биллинга

Сервис должен позволять пользователям оформлять и отменять подписку на онлайн-кинотеатр.

С помощью подписки пользователь в будущем сможет получать доступ к различным фичам онлайн-кинотеатра. Например, смотреть фильмы в лучшем качестве и/или получать доступ к киноновинкам.

Так же, для привлечения новых клиентов сервис биллинга в будущем может быть интегрирован с системой лояльности.

# Функциональные требования

## Разработать модуль по работе с платежной системой (далее - ПС)
Реализовать модуль ПС, который будет использовать севрис биллинга при оплате. Архитектура должна позволять в будущем подключать новые ПС.

## Разработать админ-панель с функциями:
1. Просмотр, создание, редактирование и деактивация подписок.
2. Просмотр реестра пользователей.
3. Просмотр истории оформления и отмены подписки по каждому пользователю.

## Разработать модуль брокера сообщений
Брокер сообщений необходим для гарантированной доставки событий о подключении/отключении подписок в сервис Auth.

## Разработать API-сервис с эндпоинтами:
1. **Получить список подписок.**
    
    Для рендера в интерфейсе.
2. **Оформить подписку.**
    
    Вызывается со стороны ПС. Сообщение о подключении подписки отправляется в брокер сообщений, который слушает Auth сервис и обновляет список прав пользователя и отзывает access-токен. 
3. **Отменить подписку.**
    
    Для пользователя проставляется отметка, что подписка неактивна. В дальнейшем шедулер ее отключит в конце периода дейсвтия.

## Создать шедулер списания оплаты
Модуль должен работать в фоне и для каждого пользователя, у которого:
1. Подключена подписка - продлевать ее в конце периода действия, используя рекуррентный платеж ПС.
2. Отключена подписка - в конце периода действия подписки отправлять сообщение об отключении подписки в брокер сообщений, который слушает Auth сервис и обновляет список прав пользователя и отзывает access-токен.

## Спроектировать базу данных, которая должна хранить:
1. Виды подписок (с сопоставлением её группе доступа сервиса Auth).
2. Пользователей.
3. Историю оформления и отмены подписок по каждому пользователю.
4. Связь пользователя с ПС для рекуррентных платежей.

# Нефункциональные требования
1. Поскольку сервису требуется аутентифицировать пользователей, необходимо реализовать валидацию токена, который генерируется сервисом авторизации. Для этого сервис биллинга должен иметь доступ к публичному RSA ключу.
